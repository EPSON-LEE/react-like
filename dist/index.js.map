{"version":3,"file":"index.js","sources":["../src/react-dom/dom.js","../src/react-dom/render.js","../src/react/component.js","../src/react/create-element.js","../src/react/index.js","../src/react-dom/index.js","../src/index.js"],"sourcesContent":["/**\n * @description:\n * @param {HTMLDivElement}\n * @param {string}\n * @param {string}\n * @return:\n */\nexport function setAttribute(dom, name, value) {\n  // 如果属性名是className，则改回class\n  if (name === 'className') name = 'class'\n\n  // 如果属性名是onXXX，则是一个事件监听方法\n  if (/on\\w+/.test(name)) {\n    dom[name.toLowerCase()] = value || ''\n    // 如果属性名是style，则更新style对象\n  } else if (name === 'style') {\n    if (!value || typeof value === 'string') {\n      dom.style.cssText = value || ''\n    } else if (value && typeof value === 'object') {\n      for (let name in value) {\n        // 可以通过style={ width: 20 }这种形式来设置样式，可以省略掉单位px\n        dom.style[name] =\n          typeof value[name] === 'number' ? value[name] + 'px' : value[name]\n      }\n    }\n    // 普通属性则直接更新属性\n  } else {\n    if (name in dom) {\n      dom[name] = value || ''\n    }\n    if (value) {\n      dom.setAttribute(name, value)\n    } else {\n      dom.removeAttribute(name)\n    }\n  }\n}\n","import Component from '../react/component'\nimport { setAttribute } from './dom'\n\nfunction createComponent(component, props) {\n  let inst\n\n  if (component.prototype && component.prototype.render) {\n    inst = new component(props)\n  } else {\n    inst = new Component(props)\n    inst.constructor = component\n    inst.render = function() {\n      return this.constructor(props)\n    }\n  }\n\n  return inst\n}\n\nfunction unmountComponent(component) {\n  if (component.componentWillUnmount) component.componentWillUnmount()\n  removeNode(component.base)\n}\n\nfunction setComponentProps(component, props) {\n  if (!component.base) {\n    if (component.componentWillMount) component.componentWillMount()\n  } else if (component.componentWillReceiveProps) {\n    component.componentWillReceiveProps(props)\n  }\n\n  component.props = props\n\n  renderComponent(component)\n}\n\nexport function renderComponent(component) {\n  let base\n\n  const renderer = component.render()\n\n  if (component.base && component.componentWillUpdate) {\n    component.componentWillUpdate()\n  }\n\n  base = _render(renderer)\n\n  if (component.base) {\n    if (component.componentDidUpdate) component.componentDidUpdate()\n  } else if (component.componentDidMount) {\n    component.componentDidMount()\n  }\n\n  if (component.base && component.base.parentNode) {\n    component.base.parentNode.replaceChild(base, component.base)\n  }\n\n  // component.base保存的是组件的dom对象\n  component.base = base\n  base._component = component\n}\n\nfunction _render(vnode) {\n  if (vnode === undefined || vnode === null || typeof vnode === 'boolean')\n    vnode = ''\n\n  if (typeof vnode === 'number') vnode = String(vnode)\n\n  if (typeof vnode === 'string') {\n    let textNode = document.createTextNode(vnode)\n    return textNode\n  }\n\n  if (typeof vnode.tag === 'function') {\n    const component = createComponent(vnode.tag, vnode.attrs)\n\n    setComponentProps(component, vnode.attrs)\n\n    return component.base\n  }\n\n  const dom = document.createElement(vnode.tag)\n\n  if (vnode.attrs) {\n    Object.keys(vnode.attrs).forEach(key => {\n      const value = vnode.attrs[key]\n\n      setAttribute(dom, key, value)\n    })\n  }\n\n  if (vnode.children) {\n    vnode.children.forEach(child => render(child, dom))\n  }\n\n  return dom\n}\n\nexport function render(vnode, container) {\n  return container.appendChild(_render(vnode))\n}\n","import { renderComponent } from '../react-dom/render'\n\n// 定义组件的结构\nclass Component {\n  constructor(props = {}) {\n    this.isReactComponent = true\n\n    this.state = {}\n    this.props = props\n  }\n\n  setState(stateChange) {\n    Object.assign(this.state, stateChange)\n    renderComponent(this)\n  }\n}\n\nexport default Component\n","function createElement(tag, attrs, ...children) {\n  return {\n    tag,\n    attrs,\n    children\n  }\n}\n\nexport default createElement","import Component from './component.js'\nimport createElement from './create-element'\n\nexport default {\n  Component,\n  createElement\n}\n","import { render, renderComponent } from './render'\nexport default {\n  render,\n  renderComponent\n}\n","import React from './react'\nimport ReactDOM from './react-dom'\n\nclass Counter extends React.Component {\n  constructor(props) {\n    super(props)\n    this.state = {\n      num: 0\n    }\n  }\n  \n  componentWillUpdate() {\n    console.log('update')\n  }\n\n  componentWillMount() {\n    console.log('mount')\n  }\n\n  componentWillUnmount() {\n    console.log('unmount')\n  }\n\n  onClick() {\n    this.setState({ num: this.state.num + 1 })\n  }\n\n  render() {\n    return (\n      <div onClick={() => this.onClick()}>\n        <h1>number: {this.state.num}</h1>\n        <button>add3</button>\n      </div>\n    )\n  }\n}\n\nReactDOM.render(<Counter />, document.getElementById('root'))\n"],"names":["setAttribute","dom","name","value","test","toLowerCase","style","cssText","removeAttribute","createComponent","component","props","inst","prototype","render","Component","constructor","setComponentProps","base","componentWillMount","componentWillReceiveProps","renderComponent","renderer","componentWillUpdate","_render","componentDidUpdate","componentDidMount","parentNode","replaceChild","_component","vnode","undefined","String","textNode","document","createTextNode","tag","attrs","createElement","Object","keys","forEach","key","children","child","container","appendChild","isReactComponent","state","stateChange","assign","Counter","num","console","log","setState","onClick","React","ReactDOM","getElementById"],"mappings":"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"}